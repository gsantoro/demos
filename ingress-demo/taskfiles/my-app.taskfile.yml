# https://taskfile.dev

version: '3'

includes:
  k8s:
    taskfile: ./k8s.k3d.taskfile.yml
    dir: ".." # NOTE: when including another taskfile you need to go up one dir to point to root
    internal: true

# Note:
tasks: 
  up: 
    cmds:
      - task: k8s:create

  load-balance-request:
    cmds:
      - kubectl apply -f manifests/load-balance-request

  load-balance-request:down:
    cmds:
      - kubectl delete -f manifests/load-balance-request

  load-balance-request:client:
    cmds:
      - |
        curl -H "Host: my-app.local" http://localhost:8080 | jq .

  mirror-request:
    cmds:
      - kubectl apply -f manifests/mirror-request --validate=false

  mirror-request:down:
    cmds:
      - kubectl delete -f manifests/mirror-request

  mirror-request:client:
    cmds:
      - |
        curl -H "Host: mirror.example" http://localhost:8080 | jq .